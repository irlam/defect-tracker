Sync System Implementation Guide

You need to do two things to ensure the automatic sync works correctly:

<?php
// 1. Include the init.php file at the top of each PHP page
require_once 'sync/init.php';

// Your regular PHP code goes here
// ...

// At the end of your <head> section or before </body>:
?>
<!DOCTYPE html>
<html>
<head>
    <title>Your Page</title>
    <!-- Your regular head content -->
    
    <!-- 2. Initialize the client-side sync functionality -->
    <?php sync_init_client(); ?>
</head>
<body>
    <!-- Your page content -->
</body>
</html>


Complete Implementation Steps

1.Server-side: Include the init file at the top of your PHP pages.

require_once 'sync/init.php';

2.Client-side: Call the sync_init_client() function in your HTML output

<?php sync_init_client(); ?>

3.Data Operations: Make sure your data operations work with the sync system:

<?php
/**
 * Example data operations with sync compatibility
 * Created: 2025-02-26 13:56:16
 * Updated by: irlam
 */

// Include the sync system
require_once 'sync/init.php';

// Example function to update a record with sync support
function updateRecord($tableName, $id, $data) {
    global $db; // Your database connection
    
    // Regular database update
    $fields = [];
    $values = [];
    
    foreach ($data as $field => $value) {
        $fields[] = "$field = ?";
        $values[] = $value;
    }
    
    $values[] = $id; // For the WHERE clause
    
    $sql = "UPDATE $tableName SET " . implode(", ", $fields) . " WHERE id = ?";
    $stmt = $db->prepare($sql);
    $success = $stmt->execute($values);
    
    if ($success) {
        // Queue the change for syncing
        // This should match how your sync-manager.js expects data
        $syncData = [
            'entity' => $tableName,
            'id' => $id,
            'action' => 'update',
            'data' => $data,
            'timestamp' => date('Y-m-d H:i:s')
        ];
        
        // Store in session for the JavaScript sync system to pick up
        if (!isset($_SESSION['pending_sync_items'])) {
            $_SESSION['pending_sync_items'] = [];
        }
        $_SESSION['pending_sync_items'][] = $syncData;
        
        // Output sync JavaScript to notify sync-manager
        echo "<script>
            if (typeof window.syncManager !== 'undefined') {
                window.syncManager.queueChange(" . json_encode($syncData) . ");
            }
        </script>";
    }
    
    return $success;
}
?>

What Will Happen Automatically:
Based on the init.php file you've shown:

The system will register a service worker that can sync data in the background
The sync-manager.js will likely monitor for network connectivity
When connectivity returns, changes made offline will be synchronized
The key components for automatic syncing are:

db-manager.js: Likely handles client-side database operations using IndexedDB
sync-manager.js: Manages the synchronization logic and network detection
service-worker.js: Provides background sync capabilities even when the browser tab is closed
Important Things to Check:
Make sure your sync-related tables are properly set up in your database
Ensure your client-side JS files (db-manager.js and sync-manager.js) are correctly implemented
Test the offline capability thoroughly by disconnecting your network and making changes.


Complete Sync System Folder Structure

/your-application-root/
├── sync/
│   ├── admin/
│   │   ├── dashboard.php
│   │   ├── performance_metrics.php
│   │   ├── admin_checkTriggers.php
│   │   ├── resolve_conflict.php
│   │   ├── sync_logs.php
│   │   └── cleanup_settings.php
│   │
│   ├── client/
│   │   ├── db-manager.js
│   │   ├── sync-manager.js
│   │   └── service-worker.js
│   │
│   ├── server/
│   │   ├── SyncEndpoint.php
│   │   └── Sync/
│   │       └── [Your Sync Classes].php
│   │
│   ├── init.php
│   └── config.php
│
├── example_page.php
└── data_operations.php

File Descriptions
Core Sync Files
sync/init.php: Main initialization file for the sync system
sync/config.php: Configuration settings for the sync system
Admin Dashboard Files
sync/admin/performance_metrics.php: Dashboard for sync performance statistics
sync/admin/dashboard.php: Main admin dashboard
sync/admin/admin_checkTriggers.php: Tool to check sync triggers
sync/admin/resolve_conflict.php: Interface for resolving sync conflicts
sync/admin/sync_logs.php: View of all sync logs
sync/admin/cleanup_settings.php: Settings for data cleanup operations
Client-Side JavaScript
sync/client/db-manager.js: Manages client-side IndexedDB operations
sync/client/sync-manager.js: Handles sync operations and network detection
sync/client/service-worker.js: Background sync functionality
Server-Side Sync Classes
sync/server/SyncEndpoint.php: API endpoint for sync operations
sync/server/Sync/*.php: PHP classes for the sync system's functionality
Example Integration Files
example_page.php: Example of how to include sync in a regular page
data_operations.php: Example of CRUD operations with sync support

How to Use This Structure
1. Include the sync system in your PHP files:
require_once 'sync/init.php';
2.Initialize client-side sync in your HTML:
<?php sync_init_client(); ?>
3. Use the data operations with sync capabilities for database interactions.

This structure provides a complete offline-capable sync system that will automatically synchronize changes when network connectivity is restored. The service worker will handle background syncing even when the browser isn't actively open to your application.

The folder structure is organized to keep sync-related functionality separate from your main application code, making it easier to maintain and update.



